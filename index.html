<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gold Sniper — Web</title>
<meta name="theme-color" content="#0b1020">
<style>
:root{--bg:#050816;--card:#0e1428;--line:#1f2a44;--ink:#e5e7eb;--muted:#9aa6bb}
*{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#050816 0%,#0b1020 100%);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:14px}
h1{font-size:20px;margin:0 0 8px}
.card{background:#121a34;border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:14px}
.row{display:flex;gap:10px;justify-content:space-between;align-items:center;flex-wrap:wrap}
.badge{background:#132044;border:1px solid #223056;padding:4px 10px;border-radius:999px;font-size:12px;color:#cfe6ff}
canvas{width:100%;height:360px;background:#0b1020;border:1px solid var(--line);border-radius:12px}
.pill{border:1px solid var(--line);background:#0c132a;color:#cbd5e1;padding:6px 10px;border-radius:999px;font-weight:600}
.ok{color:#10b981}.err{color:#ef4444}.warn{color:#f59e0b}
small{color:var(--muted)}
button{background:#0f766e;border:0;color:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="wrap">
  <h1>Gold Sniper <span class="badge">Web • GitHub Pages</span></h1>
  <div class="card">
    <div class="row">
      <div><b>XAUUSD (ذهب) — 5m</b><br><small id="status">تحميل البيانات…</small></div>
      <div>
        <button id="refresh">تحديث</button>
        <span id="signal" class="pill">—</span>
      </div>
    </div>
    <canvas id="chart"></canvas>
  </div>
</div>

<script>
async function loadCSV(){
  const url="https://stooq.com/q/d/l/?s=xauusd&i=5";
  try{
    const res=await fetch(url,{cache:"no-store"});
    if(!res.ok) throw new Error("net");
    const csv=await res.text();
    const rows=csv.trim().split(/\n+/).slice(-200);
    const out=[];
    for(let i=1;i<rows.length;i++){
      const [date,time,open,high,low,close,volume]=rows[i].split(",");
      if(!open) continue;
      out.push({t:new Date(date+'T'+(time||'00:00')+':00Z'), o:+open,h:+high,l:+low,c:+close});
    }
    if(out.length<50) throw new Error("short");
    return out;
  }catch(e){
    // بيانات احتياطية حتى تشوف الشارت لو النت ضعيف
    const out=[]; let p=2400;
    for(let i=0;i<200;i++){
      const o=p, c=p+(Math.random()-0.5)*2;
      const h=Math.max(o,c)+1, l=Math.min(o,c)-1;
      out.push({t:new Date(Date.now()-(200-i)*300000), o,h,l,c});
      p=c;
    }
    return out;
  }
}
function vwap(b){let pv=0,v=0,a=[];for(const x of b){const tp=(x.h+x.l+x.c)/3; pv+=tp; v+=1; a.push(pv/v)} return a}
function decide(b,vw){const n=b.length-1; return b[n].c>vw[n]?{t:"شراء",c:"ok"}:{t:"بيع",c:"err"}}

let chart;
async function render(){
  const st=document.getElementById("status");
  st.textContent="تحميل…";
  const bars=await loadCSV();
  st.textContent="آخر تحديث: "+new Date().toLocaleTimeString();
  const vw=vwap(bars);
  const ds=decide(bars,vw);
  const sig=document.getElementById("signal");
  sig.textContent=ds.t; sig.className="pill "+ds.c;

  const labels=bars.map(b=> new Intl.DateTimeFormat('ar-IQ',{hour:'2-digit',minute:'2-digit'}).format(b.t));
  const close=bars.map(b=>b.c);

  const ctx=document.getElementById("chart").getContext("2d");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{labels,datasets:[
      {label:"الإغلاق",data:close,borderWidth:2,pointRadius:0,tension:.25},
      {label:"VWAP",data:vw,borderWidth:2,pointRadius:0,tension:.25}
    ]},
    options:{responsive:true,plugins:{legend:{labels:{color:"#e5e7eb"}}},
      scales:{x:{ticks:{color:"#94a3b8"},grid:{color:"#1f2a44"}},
              y:{ticks:{color:"#94a3b8"},grid:{color:"#1f2a44"}}}}
  });
}
document.getElementById("refresh").addEventListener("click", render);
render();
</script>
</body>
</html>
